let e=null,t=[],n=null,o=0,l=0,i=!1;const a={NORMAL:"normal",EXPLORE:"explore"};let r=a.NORMAL,d=!1,h=!1,c=null;const s=()=>{let{ctx:d,viewportWidth:m,viewportHeight:w}=e;if(h)c&&d.drawImage(c.element,0,0,m,w);else if(.002>Math.random()&&t.length>5&&(t=[],l=20+Math.floor(30*Math.random())),l>0&&l--,0===o&&t.length>0){if(i=!1,r===a.EXPLORE){let e=.6*Math.random(),t=n.element.width*e,l=n.element.height*e,i=t*Math.random(),h=l*Math.random();d.drawImage(n.element,i,h,t,l,0,0,m,w),.2>Math.random()&&(r=a.NORMAL),o=1}r===a.NORMAL&&((!n||.7>Math.random())&&(n=t[Math.floor(Math.random()*t.length)]),d.drawImage(n.element,0,0,m,w),.15>Math.random()&&(r=a.EXPLORE),o=t.length<5?Math.floor(Math.random()*(20-t.length)*3):t.length<10?Math.floor(4*Math.random()):Math.floor(2*Math.random()),i=!1),n&&!i&&(c=n)}else!i&&.8>Math.random()&&(d.fillStyle="#000000",d.fillRect(0,0,m,w),i=!0),o>0&&o--;requestAnimationFrame(s)},m=()=>{let{ctx:t}=e;t.imageSmoothingEnabled=!1,t.fillStyle="#000000",t.fillRect(0,0,e.viewportWidth,e.viewportHeight),requestAnimationFrame(s)},w=()=>{let t=document.createElement("canvas"),n=t.getContext("2d"),o=()=>{let e=window.devicePixelRatio||1,o=window.innerWidth,l=window.innerHeight;return t.width=o*e,t.height=l*e,t.style.width=`${o}px`,t.style.height=`${l}px`,n.scale(e,e),{viewportWidth:o,viewportHeight:l}},l=o();return window.addEventListener("resize",()=>{let t=o();e.viewportWidth=t.viewportWidth,e.viewportHeight=t.viewportHeight}),t.addEventListener("mousedown",()=>h=!0),t.addEventListener("mouseup",()=>h=!1),t.addEventListener("mouseleave",()=>h=!1),document.body.appendChild(t),{canvas:t,ctx:n,viewportWidth:l.viewportWidth,viewportHeight:l.viewportHeight}};function g({allowNSFW:n=!1}={}){let o=new WebSocket("ws://localhost:3001");document.getElementById("feed"),function({allowNSFW:t=!1}={}){d=t,e=w(),m()}({allowNSFW:n}),o.onmessage=o=>{JSON.parse(o.data).embed.images.forEach(o=>{!function(n){let o=(n.classification||[]).some(e=>("Porn"===e.className||"Hentai"===e.className)&&e.probability>.05);if(!d&&o)return console.warn("NSFW content filtered");t.length>=20&&t.shift();let l=new Image;l.src=n.fullsize,l.onload=()=>{let n=Math.min(300/l.width,300/l.height,1),o=l.width*n,i=l.height*n;t.push({element:l,width:o,height:i,x:Math.floor(Math.random()*(e.viewportWidth-o)),y:Math.floor(Math.random()*(e.viewportHeight-i))})}}(o,n)})},o.onclose=()=>{console.log("WebSocket closed. Reconnecting..."),setTimeout(g,1e3),console.log("Attempting to reconnect...")},o.onerror=e=>{console.error("WebSocket error:",e),o.close()},o.onopen=()=>{console.log("WebSocket connected")}}new WebSocket("ws://localhost:3001"),document.getElementById("feed"),document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("modal"),t=document.querySelector(".warning-1"),n=document.querySelector(".warning-2");document.querySelector(".warning-1 button").addEventListener("click",()=>{t.style.display="none",n.style.display="block"}),document.querySelector(".warning-2 button.sfw").addEventListener("click",()=>{e.style.display="none",g({allowNSFW:!1})}),document.querySelector(".warning-2 button.nsfw").addEventListener("click",()=>{e.style.display="none",g({allowNSFW:!0})})});
//# sourceMappingURL=index.ffef2814.js.map
